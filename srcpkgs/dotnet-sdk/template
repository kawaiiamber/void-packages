# Template file for 'dotnet-sdk'
pkgname=dotnet-sdk
version=5.0.202
revision=1
wrksrc="source-build-${version}-SDK"
hostmakedepends="git tar wget python cmake clang llvm inetutils"
makedepends="icu-devel libunwind-devel lttng-ust-devel zlib-devel mit-krb5-devel libxml2-devel libgit2-devel"
short_desc="SDK for making dotnet CORE apps"
maintainer="KawaiiAmber <japaneselearning101@gmail.com>"
license="MIT"
homepage="https://dotnet.microsoft.com"
distfiles="https://github.com/dotnet/source-build/archive/refs/tags/v${version}-SDK.tar.gz"
checksum=aea8e4f3323aa95316969958585ccc7030f9be7c79d38188a9137ef789ada7cd

_prof=${DESTDIR}/etc/profile.d
_target=${DESTDIR}/usr/libexec/dotnet

case "${XBPS_TARGET_MACHINE}" in
	"x86_64*") _ARCHITECTURE="x64" ;;
	"aarch64*") _ARCHITECTURE="arm64" ;;
esac
_RUNTIME_ID="void-${_ARCHITECTURE}"

do_configure() {
	vmkdir ${_prof}
	vcopy ${FILESDIR}/dotnet.sh ${_prof}
}

do_build() {
	git init
	DOTNET_CLI_TELEMETRY_OPTOUT="true" sh ./build.sh -b
}

post_build() {
	tar -zxvf ./artifacts/"${_ARCHITECTURE}"/Release/dotnet-sdk-"${version}"-"${RUNTIME_ID}".tar.gz
}

do_install() {
	vmkdir ${_target}
	for file in artifacts/"${_ARCHITECTURE}"/Release/dotnet-sdk-"${version}"-"${RUNTIME_ID}"/*
	do
		vcopy ${file} ${_target}
	done
}

post_install() {
	vlicense LICENSE.txt
}
